graph TB
    subgraph "🏭 DigitalHouseFactory"
        F[Factory Contract]
        F --> PV1[Parent Vault: HOTEL-MIAMI-001]
        F --> PV2[Parent Vault: HOTEL-NYC-002]
        F --> PV3[Parent Vault: APT-LA-003]
    end
    
    subgraph "🏨 HOTEL-MIAMI-001 (Parent Vault)"
        PV1 --> |"Master Code: MIAMI2024"| PV1_INFO["🏠 Property: Luxury Hotel Miami<br/>💰 Base Price: 1000 PYUSD<br/>👤 Owner: hotel.eth<br/>🔑 Access Code: MIAMI2024"]
        
        PV1 --> SV1["📅 Sub-Vault: Dec 1-3<br/>ID: HOTEL-MIAMI-001-1733011200-1733270400"]
        PV1 --> SV2["📅 Sub-Vault: Dec 5-7<br/>ID: HOTEL-MIAMI-001-1733443200-1733702400"]
        PV1 --> SV3["📅 Sub-Vault: Dec 10-12<br/>ID: HOTEL-MIAMI-001-1733875200-1734134400"]
        
        SV1 --> SV1_STATE{State: AUCTION<br/>👤 Booker: userA<br/>💰 Stake: 1000 PYUSD}
        SV2 --> SV2_STATE{State: SETTLED<br/>👤 Booker: userB<br/>🔑 Code: MIAMI2024}
        SV3 --> SV3_STATE{State: FREE<br/>Available for booking}
    end
    
    subgraph "🏙️ HOTEL-NYC-002 (Parent Vault)"
        PV2 --> |"Master Code: NYC2024"| PV2_INFO["🏠 Property: Boutique Hotel NYC<br/>💰 Base Price: 1500 PYUSD<br/>👤 Owner: hotel.eth<br/>🔑 Access Code: NYC2024"]
        
        PV2 --> SV4["📅 Sub-Vault: Dec 1-3<br/>ID: HOTEL-NYC-002-1733011200-1733270400"]
        PV2 --> SV5["📅 Sub-Vault: Dec 8-10<br/>ID: HOTEL-NYC-002-1733702400-1733961600"]
        
        SV4 --> SV4_STATE{State: AUCTION<br/>👤 Booker: userC<br/>💰 Stake: 1500 PYUSD}
        SV5 --> SV5_STATE{State: FREE<br/>Available for booking}
    end
    
    subgraph "👥 Users"
        U1[👤 User A<br/>Booked: Miami Dec 1-3]
        U2[👤 User B<br/>Booked: Miami Dec 5-7]
        U3[👤 User C<br/>Booked: NYC Dec 1-3]
        U4[👤 User D<br/>Looking for dates...]
    end
    
    subgraph "🔄 Booking Flow"
        FLOW1[1. User selects dates]
        FLOW2[2. Factory checks availability]
        FLOW3[3. Creates Sub-Vault if needed]
        FLOW4[4. User creates reservation]
        FLOW5[5. Auction & bidding]
        FLOW6[6. Check-in with inherited access code]
        FLOW7[7. Check-out & vault reset]
        
        FLOW1 --> FLOW2
        FLOW2 --> FLOW3
        FLOW3 --> FLOW4
        FLOW4 --> FLOW5
        FLOW5 --> FLOW6
        FLOW6 --> FLOW7
        FLOW7 --> FLOW1
    end
    
    %% Connections
    U1 -.-> SV1
    U2 -.-> SV2
    U3 -.-> SV4
    U4 -.-> SV3
    U4 -.-> SV5
    
    %% Styling
    classDef parentVault fill:#fff3e0,stroke:#f57c00,stroke-width:2px;
    classDef subVault fill:#e3f2fd,stroke:#1976d2,stroke-width:1px;
    classDef vaultState fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px;
    classDef user fill:#e8f5e8,stroke:#388e3c,stroke-width:1px;
    classDef factory fill:#fce4ec,stroke:#c2185b,stroke-width:2px;
    classDef flow fill:#f1f8e9,stroke:#689f38,stroke-width:1px;
    
    class PV1,PV2,PV3 parentVault
    class SV1,SV2,SV3,SV4,SV5 subVault
    class SV1_STATE,SV2_STATE,SV3_STATE,SV4_STATE,SV5_STATE vaultState
    class U1,U2,U3,U4 user
    class F factory
    class FLOW1,FLOW2,FLOW3,FLOW4,FLOW5,FLOW6,FLOW7 flow
