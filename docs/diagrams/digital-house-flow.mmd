flowchart TD
    A[ğŸ¨ Hotel creates Parent Vault via Factory<br/>ğŸ”‘ Master Access Code: HOTEL123] --> B{Parent Vault: ACTIVE}
    
    B --> B1[ğŸ‘¤ User A wants to book<br/>ğŸ“… Dec 1-3, 2024]
    B1 --> B2[ğŸ­ Factory creates Sub-Vault<br/>ID: HOTEL-001-1733011200-1733270400]
    B2 --> C[ğŸ‘¤ User A creates reservation in Sub-Vault<br/>Stake: 1,000 PYUSD]
    C --> D{Sub-Vault State: AUCTION}
    
    D --> E[â° Auction Period<br/>Until 24hrs before check-in]
    
    E --> F{Any bids?}
    F -->|No| M[â° Check-in Time]
    F -->|Yes| G[ğŸ‘¥ User B places bid<br/>Bid: 1,500 PYUSD]
    
    G --> H{Does User A cede?}
    
    H -->|Doesn't cede| M
    H -->|Cedes| I[ğŸ’° Citizen Value Distribution]
    
    I --> J[ğŸ‘¤ A receives: 1,150 PYUSD<br/>ğŸ¨ Hotel: 250 PYUSD<br/>ğŸ  Digital House: 100 PYUSD]
    J --> K[ğŸ”„ Reservation transferred to User B<br/>New stake: 1,000 PYUSD]
    K --> M
    
    M --> N{Is correct booker?}
    N -->|No| O[âŒ Check-in failed]
    N -->|Yes| P[âœ… Check-in successful<br/>ğŸ”‘ Access Code: HOTEL123<br/>ğŸ“± Inherited from Parent Vault]
    
    P --> Q[ğŸ’° New Payment Distribution<br/>Base: 950 PYUSD â†’ Hotel, 50 PYUSD â†’ Platform<br/>Additional Value: 40% Current, 30% Last, 20% Hotel, 10% Platform]
    Q --> R{Sub-Vault State: SETTLED}
    
    R --> S[â° Check-out Time]
    S --> T[ğŸ‘¤ User checks out]
    T --> U{Sub-Vault State: FREE}
    
    U --> V[ğŸ”„ Meanwhile, other users can book<br/>ğŸ“… Different dates in same Parent Vault]
    V --> B1
    
    %% Styling
    classDef userAction fill:#e1f5fe,stroke:#0288d1,stroke-width:1px;
    classDef vaultState fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px;
    classDef payment fill:#e8f5e8,stroke:#388e3c,stroke-width:1px;
    classDef hotel fill:#fff3e0,stroke:#f57c00,stroke-width:1px;
    
    class B1,C,G,T userAction
    class B,B2 vaultState
    class D vaultState
    class R vaultState
    class U vaultState
    class I payment
    class J payment
    class Q payment
    class A,V hotel
