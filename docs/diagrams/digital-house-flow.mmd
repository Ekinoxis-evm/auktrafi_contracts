flowchart TD
    A[ğŸ¨ Hotel creates Vault via Factory] --> B{Vault State: FREE}
    
    B --> C[ğŸ‘¤ User A creates reservation<br/>Stake: 1,000 PYUSD]
    C --> D{Vault State: AUCTION}
    
    D --> E[â° Auction Period<br/>Until 24hrs before check-in]
    
    E --> F{Any bids?}
    F -->|No| M[â° Check-in Time]
    F -->|Yes| G[ğŸ‘¥ User B places bid<br/>Bid: 1,500 PYUSD]
    
    G --> H{Does User A cede?}
    
    H -->|Doesn't cede| M
    H -->|Cedes| I[ğŸ’° Citizen Value Distribution]
    
    I --> J[ğŸ‘¤ A receives: 1,150 PYUSD<br/>ğŸ¨ Hotel: 250 PYUSD<br/>ğŸ  Digital House: 100 PYUSD]
    J --> K[ğŸ”„ Reservation transferred to User B<br/>New stake: 1,000 PYUSD]
    K --> M
    
    M --> N{Is correct booker?}
    N -->|No| O[âŒ Check-in failed]
    N -->|Yes| P[âœ… Check-in successful<br/>Access code generated]
    
    P --> Q[ğŸ¨ Payment to Hotel: 950 PYUSD<br/>ğŸ  Digital House: 50 PYUSD]
    Q --> R{Vault State: SETTLED}
    
    R --> S[â° Check-out Time]
    S --> T[ğŸ‘¤ User checks out]
    T --> U{Vault State: FREE}
    U --> B
    
    %% Styling
    classDef userAction fill:#e1f5fe,stroke:#0288d1,stroke-width:1px;
    classDef vaultState fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px;
    classDef payment fill:#e8f5e8,stroke:#388e3c,stroke-width:1px;
    classDef hotel fill:#fff3e0,stroke:#f57c00,stroke-width:1px;
    
    class C,G,T userAction
    class B vaultState
    class D vaultState
    class R vaultState
    class U vaultState
    class I payment
    class J payment
    class Q payment
    class A hotel
