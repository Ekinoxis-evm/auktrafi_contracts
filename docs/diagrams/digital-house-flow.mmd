flowchart TD
    A[🏨 Hotel creates Parent Vault via Factory<br/>🔑 Master Access Code: HOTEL123] --> B{Parent Vault: ACTIVE}
    
    B --> B1[👤 User A wants to book<br/>📅 Dec 1-3, 2024]
    B1 --> B2[🏭 Factory creates Sub-Vault<br/>ID: HOTEL-001-1733011200-1733270400]
    B2 --> C[👤 User A creates reservation in Sub-Vault<br/>Stake: 1,000 PYUSD]
    C --> D{Sub-Vault State: AUCTION}
    
    D --> E[⏰ Auction Period<br/>Until 24hrs before check-in]
    
    E --> F{Any bids?}
    F -->|No| M[⏰ Check-in Time]
    F -->|Yes| G[👥 User B places bid<br/>Bid: 1,500 PYUSD]
    
    G --> H{Does User A cede?}
    
    H -->|Doesn't cede| M
    H -->|Cedes| I[💰 Citizen Value Distribution]
    
    I --> J[👤 A receives: 1,150 PYUSD<br/>🏨 Hotel: 250 PYUSD<br/>🏠 Digital House: 100 PYUSD]
    J --> K[🔄 Reservation transferred to User B<br/>New stake: 1,000 PYUSD]
    K --> M
    
    M --> N{Is correct booker?}
    N -->|No| O[❌ Check-in failed]
    N -->|Yes| P[✅ Check-in successful<br/>🔑 Access Code: HOTEL123<br/>📱 Inherited from Parent Vault]
    
    P --> Q[💰 New Payment Distribution<br/>Base: 950 PYUSD → Hotel, 50 PYUSD → Platform<br/>Additional Value: 40% Current, 30% Last, 20% Hotel, 10% Platform]
    Q --> R{Sub-Vault State: SETTLED}
    
    R --> S[⏰ Check-out Time]
    S --> T[👤 User checks out]
    T --> U{Sub-Vault State: FREE}
    
    U --> V[🔄 Meanwhile, other users can book<br/>📅 Different dates in same Parent Vault]
    V --> B1
    
    %% Styling
    classDef userAction fill:#e1f5fe,stroke:#0288d1,stroke-width:1px;
    classDef vaultState fill:#f3e5f5,stroke:#7b1fa2,stroke-width:1px;
    classDef payment fill:#e8f5e8,stroke:#388e3c,stroke-width:1px;
    classDef hotel fill:#fff3e0,stroke:#f57c00,stroke-width:1px;
    
    class B1,C,G,T userAction
    class B,B2 vaultState
    class D vaultState
    class R vaultState
    class U vaultState
    class I payment
    class J payment
    class Q payment
    class A,V hotel
