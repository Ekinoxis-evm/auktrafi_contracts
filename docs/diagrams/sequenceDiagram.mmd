```mermaid
sequenceDiagram
    participant H as 🏨 Hotel
    participant F as 📦 Factory
    participant V as 🏠 Vault
    participant A as 👤 User A
    participant B as 👥 User B
    participant P as 💰 PYUSD Token
    participant DH as 🏢 Digital House

    Note over H,DH: 1. Vault Creation
    H->>F: createVault("APT-BOG-101", "1000 PYUSD")
    F->>V: deploy new Vault
    F-->>H: vault address

    Note over H,DH: 2. Initial Reservation
    A->>P: approve(vault, 1000 PYUSD)
    A->>V: createReservation(1000, checkIn, checkOut)
    V->>P: transferFrom(A, vault, 1000)
    V-->>A: ✅ Reservation created (State: AUCTION)

    Note over H,DH: 3. Auction Period
    B->>P: approve(vault, 1500 PYUSD)
    B->>V: placeBid(1500 PYUSD)
    V->>P: transferFrom(B, vault, 1500)
    V-->>B: ✅ Bid registered

    Note over H,DH: 4. Cession (Citizen Value)
    Note over A: 24hrs before check-in
    A->>V: cedeReservation(bidIndex: 0)
    
    rect rgb(255, 248, 220)
        Note over V,DH: Additional Value Distribution (500 PYUSD)
        V->>P: transfer(A, 1150 PYUSD) # 1000 + 150 citizen value
        V->>P: transfer(Hotel, 250 PYUSD) # 50% of additional
        V->>P: transfer(DH, 100 PYUSD) # 20% of additional
    end
    
    V-->>A: ✅ 1,150 PYUSD received
    V-->>B: ✅ Reservation transferred (new stake: 1,000 PYUSD)

    Note over H,DH: 5. Check-in and Final Payment
    Note over B: Check-in day
    B->>V: checkIn()
    
    rect rgb(232, 245, 233)
        Note over V,DH: Normal Payment Distribution (1,000 PYUSD)
        V->>P: transfer(Hotel, 950 PYUSD) # 95%
        V->>P: transfer(DH, 50 PYUSD) # 5%
    end
    
    V-->>B: ✅ Access code: "123456"

    Note over H,DH: 6. Check-out and Reset
    Note over B: Check-out day
    B->>V: checkOut()
    V-->>B: ✅ Stay completed
    Note over V: State: FREE (ready for new reservation)
```
